---
figureTitle: Рисунок
tableTitle: Таблица
listingTitle: Листинг
tableEqns: true
titleDelim: "&nbsp;–"
link-citations: true
linkReferences: true
chapters: true
...
<!--
Описание необходимых файлов картинок:
test1.png - Тестирование работы вставки элемента в таблицу
test2.png - Тестирование работы вставки с коллизией
test3.png - Тестирование работы вставки с рехэшированием
test4.png - Тестирование работы успешный поиска элемента
test5.png - Тестирование работы неуспешный поиска элемента
test6.png - Тестирование работы удаления элемента из таблицы
test7.png - Тестирование работы с хэш-таблицей с коллизией
test8.png - Тестирование работы с хэш-таблицей с рехэшированием
test9.png - Тестирование работы вставки элемента таблицей
test10.png - Тестирование работы удаление элемента из таблицы
test11.png - Содержание записи для первой записи в файле
test12.png - Результат поиска в таблице для первой записи в файле
test13.png - Содержание записи для последней записи в файле
test14.png - Результат поиска в таблице для последней записи в файле
test15.png - Содержание записи для некрайней записи в файле
test16.png - Результат поиска в таблице для некрайней записи в файле
-->

# [Содержание]{custom-style="UnnumberedHeadingOneNoTOC"} {.unnumbered}

%TOC%

# УСЛОВИЕ ЗАДАЧИ И ЗАДАНИЕ ВАРИАНТА

## Формулировка

Разработать приложение, которое использует хеш-таблицу для
организации прямого доступа к записям двоичного файла, реализованного в
практической работе 2.

## Требования

1. Создать приложение и включить в него три заголовочных файла:
управление хеш-таблицей, управление двоичным файлом (практическая работа 2), управление двоичным файлом посредством хеш-таблицы. Имена
заголовочным файлам определите сами. Подключите заголовочные файлы к
приложению.

2. Для обеспечения прямого доступа к записи в файле элемент хеш-таблицы
должен включать обязательные поля: ключ записи в файле, номер записи с
этим ключом в файле. Элемент может содержать другие поля, требующиеся
методу (указанному в вашем варианте), разрешающему коллизию.

3. Управление хеш-таблицей.
	1) Определить структуру элемента хеш-таблицы и структуру хеш-таблицы в
соответствии с методом разрешения коллизии, указанном в варианте.
Определения разместить в соответствующем заголовочном файле. Все
операции управления хеш-таблицей размещать в этом заголовочном
файле.
	2) Тестирование операций выполнять в функции main приложения по мере
их реализации.
После тестирования всех операций, создать в заголовочном файле
функцию с именем testHeshT переместить в нее содержание функции
main, проверить, что приложение выполняется.
Разработать операции по управлению хеш-таблицей.
	3) Разработать хеш-функцию (метод определить самостоятельно),
выполнить ее тестирование, убедиться, что хеш (индекс элемента
таблицы) формируется верно.
	4) Разработать операции: вставить ключ в таблицу, удалить ключ из
таблицы, найти ключ в таблице, рехешировать таблицу. Каждую
операцию тестируйте по мере ее реализации.
	5) Подготовить тесты (последовательность значений ключей),
обеспечивающие:

		− вставку ключа без коллизии

		− вставку ключа и разрешение коллизии

		− вставку ключа с последующим рехешированием

		− удаление ключа из таблицы

		− поиск ключа в таблице

		Примечание. Для метода с открытым адресом подготовить тест для поиска ключа, который размещен в таблице после удаленного ключа, с одним значением хеша для этих ключей.
	6) Выполнить тестирование операций управления хеш-таблицей. При
тестировании операции вставки ключа в таблицу предусмотрите вывод
списка индексов, которые формируются при вставке элементов в таблицу.

4. Управление двоичным файлом.
Операции управления двоичным файлом: создание двоичного файла из
текстового, добавить запись в двоичный файл, удалить запись с заданным
ключом из файла, прочитать запись файла по заданному номеру записи.
Примечание. Эти операции должны быть отлажены в практической работе 2,
или уже в этой работе, если их пока нету.
Структура записи двоичного файла и все операции, по управлению
файлом, должны быть размещены в соответствующем заголовочном файле.
Выполнить тестирование операций в main приложения, и содержание
функции main переместить в соответствующую функцию заголовочного файла
с именем testBinF.

5. Управление файлом посредством хеш-таблицы.
В заголовочный файл управления файлом посредством хеш-таблицы
подключить заголовочные файлы: управления хеш-таблицей, управления
двоичным файлом. Реализовать поочередно все перечисленные ниже операции
в этом заголовочном файле, выполняя их тестирование из функции main
приложения. После разработки всех операций выполнить их комплексное
тестирование.
Разработать и реализовать операции.
	1) Прочитать запись из файла и вставить элемент в таблицу (элемент
включает: ключ и номер записи с этим ключом в файле, и для метода с
открытой адресацией возможны дополнительные поля).
	2) Удалить запись из таблицы при заданном значении ключа и
соответственно из файла.
	3) Найти запись в файле по значению ключа (найти ключ в хеш-таблице,
получить номер записи с этим ключом в файле, выполнить прямой доступ
к записи по ее номеру)..
	4) Подготовить тесты для тестирования приложения:
Заполните файл небольшим количеством записей.
− Включите в файл записи как не приводящие к коллизиям, так и
приводящие.
− Обеспечьте включение в файл такого количества записей, чтобы
потребовалось рехеширование.
Заполните файл большим количеством записей (до 1 000 000).
− Определите время чтения записи с заданным ключом: для первой записи
файла, для последней и где-то в середине. Убедитесь (или нет), что время
доступа для всех записей одинаково.

6. Составить отчет


## Формулировка задания варианта
**Дополнительное задание варианта**:



|    Номер варианта   |        Метод хеширования         |
|:-------------------:|:--------------------------------:|
| 18 | Открытый адрес (двойное хеширование) |

# Постановка задачи
Дано.
Файл двоичный с записями фиксированной длины.
Структура записи файла согласно варианту (изобразить в форме таблицы,
указав названия полей).

Результат.
Хеш-таблица

# Подход к решению

## Файл двоичный из записей фиксированного размера 

### Структура записи файла из кода
<!--Код структуры данных--> 
```{#lst:1-1 .txt caption="Код структуры данных"}
struct ReaderTicket
{
    int key; //ключ
    char fio[30];
    char phoneNumber[15];

    void print() const
    {
        cout << "Читательский билет: " << endl;
        cout << "Номер билета: " << this->key << endl;
        cout << "Фио: " << this->fio << endl;
        cout << "Номер телефона: " << this->phoneNumber << endl;
    }

    ReaderTicket() {}

    ReaderTicket(const ReaderTicket& other)
    {
        this->key = other.key;
        memcpy(this->fio, other.fio,  30);
        memcpy(this->phoneNumber, other.phoneNumber, 15);
    }
};
```
### Размер записи файла в байтах - 49 (52 практически с учётом настроек компилятора)

### Прототипы операций по управлению двоичным файлом с указанием предусловия и постусловия


#### Функция convertTextToBin

Реализует: конвертацию текстового файла в двоичный файл для записей типа ReaderTicket

Предусловие: filename1 - имя текстового файла, filename2 - имя двоичного файла

```{#lst:a .cpp caption="Заголовок функции "}
int convertTextToBin(const string& filename1, const string& filename2);
```

Постусловие: Возвращает: -2, если создать двоичный файл не удалось, -1, если не удалось открыть текстовый файл, 0, если конвертация прошла успешно, 1, если произошла ошибка

#### Функция addRecordToBin

Реализует: Добавление записи в конец файла

Предусловие: filename - имя двоичного файла, record - указатель на объект записи

```{#lst:b .cpp caption="Заголовок функции "}
int addRecordToBin(const string& filename, const Ticket* record);
```

Постусловие: Возвращает -1, если открыть файл не удалось, 0, если запись прошла успешно, 1, если произошла ошибка

#### Функция deleteRecordFromBinByNumber

Реализует: Удаление записи из файла по порядковому номеру

Предусловие: filename - имя двоичного файла, number - номер записи в файле, где нумерация происходит от единицы

```{#lst:c .cpp caption="Заголовок функции "}
int deleteRecordFromBinByNumber(const string& filename, int number);
```

Постусловие: Возвращает -2, если запись не найдена в файле, -1, если открыть файл не удалось, 0, если удаление прошло успешно, 1, если произошла ошибка

#### Функция getRecordFromBin

Реализует: Чтение записи из файла по порядковому номеру

Предусловие: filename - имя файла, number - номер записи в файле (нумерация от 1-цы), toWrite - адрес объекта записи

```{#lst:d .cpp caption="Заголовок функции "}
int getRecordFromBin(const string& filename, int number, Ticket*& toWrite);
```

Постусловие: Возвращает -2, если запись не найдена в файле, -1, если открыть файл не удалось, 0, если запись считана успешно, 1, если произошла ошибка

#### Функция searchRecordFromBin

Реализует: Поиск записи в файле по ключу

Предусловие: filename - имя файла, key - ключ записи, toWrite - адрес объекта записи, number - переменная для записи порядкового номера записи в файле

```{#lst:d .cpp caption="Заголовок функции "}
int searchRecordFromBin(const string& filename, int key, Ticket*& toWrite, int& number);
```

Постусловие: Возвращает -2, если запись не найдена в файле, -1, если открыть файл не удалось, 0, если запись считана успешно, 1, если произошла ошибка

#### Функция printFromBin

Реализует: Вывод содержимого файла в поток стандартного вывода

Предусловие: filename - имя файла

```{#lst:d .cpp caption="Заголовок функции "}
int printFromBin(const string& filename1);
```

Постусловие: Возвращает -1, если открыть файл не удалось, 0, если содержимое было передано в стандартный поток вывода, 1, если произошла ошибка

#### Функция testBinF

Реализует: Тестирование модуля для работы с двоичным файлом

Предусловие: filename - имя файла

```{#lst:d .cpp caption="Заголовок функции "}
void testBinF(const string& filename);
```

Постусловие: нету



## Хеш-таблица

### Структура элемента таблицы

|           Название поля          |       Назначение поля      |
|:--------------------------------:|:--------------------------:|
| key | уникальное значение ключа, используется для доступа к ассоциированным данным |
| value | ассоциированные с ключём данные, используется для хранения информации |
| flags | комбинированное значение флагов, таких как Открыт ли элемент таблицы, Удалён ли элемент таблицы, используется для разрешения коллизий в таблице |


### Код элемента таблицы
Код элемента таблицы приведён в листинге [-@lst:1-2].
<!--Код структуры - элемента хэш таблице--> 
```{#lst:1-2 .txt caption="Код элемента таблицы
"}
```

### Реализация структуры таблицы
Код структуры таблицы [-@lst:1-3].
<!--Код структуры хэш таблицы--> 
```{#lst:1-3 .txt caption="Структура таблицы
"}
```

### Описание алгоритмов операций
1. Вставка ключа в таблицу - <!--Описать функцию-->
2. Поиск записи по ключу в таблице и возвращение номера записи в файле - <!--Описать функцию-->
3. Удаление элемента из хеш-таблицы - <!--Описать функцию-->


## Алгоритм поиска записи с заданным ключом в файле посредством хештаблицы <!--Текст с описанием алгоритма-->

## Код программы

### Код файла _НАЗВАНИЕ_ФАЙЛА_.h<!--Название файла, заменить _НАЗВАНИЕ_ФАЙЛА_  управление хеш-таблицей-->
Код файла _НАЗВАНИЕ_ФАЙЛА_.h приведён в листинге [-@lst:1-4].
<!--Код файла--> 
```{#lst:1-4 .txt caption="Код файла
"}
```

### Код файла _НАЗВАНИЕ_ФАЙЛА_.cpp<!--Название файла, заменить _НАЗВАНИЕ_ФАЙЛА_ управление хеш-таблицей-->
Код файла _НАЗВАНИЕ_ФАЙЛА_.cpp приведён в листинге [-@lst:1-5].
<!--Код файла--> 
```{#lst:1-5 .txt caption="Код файла
"}
```

### Код файла _НАЗВАНИЕ_ФАЙЛА_.h<!--Название файла, заменить _НАЗВАНИЕ_ФАЙЛА_  управление двоичным файлом (практическая работа 2)-->
Код файла _НАЗВАНИЕ_ФАЙЛА_.h приведён в листинге [-@lst:1-6].
<!--Код файла--> 
```{#lst:1-6 .txt caption="Код файла
"}
```

### Код файла _НАЗВАНИЕ_ФАЙЛА_.cpp<!--Название файла, заменить _НАЗВАНИЕ_ФАЙЛА_ управление двоичным файлом (практическая работа 2)-->
Код файла _НАЗВАНИЕ_ФАЙЛА_.cpp приведён в листинге [-@lst:1-7].
<!--Код файла--> 
```{#lst:1-7 .txt caption="Код файла
"}
```

### Код файла _НАЗВАНИЕ_ФАЙЛА_.h<!--Название файла, заменить _НАЗВАНИЕ_ФАЙЛА_  управление двоичным файлом посредством хеш-таблицы-->
Код файла _НАЗВАНИЕ_ФАЙЛА_.h приведён в листинге [-@lst:1-8].
<!--Код файла--> 
```{#lst:1-8 .txt caption="Код файла
"}
```

### Код файла _НАЗВАНИЕ_ФАЙЛА_.cpp<!--Название файла, заменить _НАЗВАНИЕ_ФАЙЛА_ управление двоичным файлом посредством хеш-таблицы-->
Код файла _НАЗВАНИЕ_ФАЙЛА_.cpp приведён в листинге [-@lst:1-9].
<!--Код файла--> 
```{#lst:1-9 .txt caption="Код файла
"}
```

### Код файла _НАЗВАНИЕ_ФАЙЛА_.cpp<!--Название файла, заменить _НАЗВАНИЕ_ФАЙЛА_ главная программа-->
Код файла _НАЗВАНИЕ_ФАЙЛА_.cpp приведён в листинге [-@lst:1-10].
<!--Код файла--> 
```{#lst:1-10 .txt caption="Код файла
"}
```
## Тестирование операций управления файлом посредством хеш-таблицы

### Функции для работы с хэш таблицей

#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Вставку элемента в таблицу

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->

![Практический результат](test1.png){#fig:1-1}

#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Вставку элемента в таблицу с коллизией

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->

![Практический результат](test2.png){#fig:1-2}

#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Вставку элемента в таблицу с рехэшированием

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->

![Практический результат](test3.png){#fig:1-3}


#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Поиск элемента в таблице

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->
![Практический результат](test4.png){#fig:1-4}<!--Успешный поиск-->
![Практический результат](test5.png){#fig:1-5}<!--Неуспешный поиск-->


#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Удаление элемента из таблице

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->

![Практический результат](test6.png){#fig:1-6}

### Функции для управления двоичным файлом с помощью хэш-таблицы

#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Работу с хэш-таблицей с коллизией

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->

![Практический результат](test7.png){#fig:1-7}

#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Работу с хэш-таблицей с рехэшированием

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->

![Практический результат](test8.png){#fig:1-8}

#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Вставку элемента

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->

![Практический результат](test9.png){#fig:1-9}

#### Функция <!--Название функции, заменить _НАЗВАНИЕ_ФУНКЦИИ_-->
Реализует: Удаление элемента из таблицы

Предусловие: <!--Предусловие к функции-->

Постусловие <!--Постусловие к функции-->

![Практический результат](test10.png){#fig:1-10}

## Результат тестирования

###  Для первой записи файла

![Содержание записи](test11.png){#fig:1-11}
![Результат поиска в таблице](test12.png){#fig:1-12}

###  Для последней записи файла

![Содержание записи](test13.png){#fig:1-13}
![Результат поиска в таблице](test14.png){#fig:1-14}

###  Для некрайней записи файла

![Содержание записи](test15.png){#fig:1-15}
![Результат поиска в таблице](test16.png){#fig:1-16}